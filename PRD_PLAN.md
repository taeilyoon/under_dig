# Under Dig - 제품 요구 사항 문서 (Part 1: 계획)

## 1. 제품 개요
**앱 이름**: Under Dig  
**플랫폼**: Android / iOS (Flutter)  
**장르**: 수직 생존 퍼즐 / 로그라이트  
**핵심 컨셉**: "Dig or Die (파거나 죽거나)". 플레이어가 공간, 적, HP를 관리하며 끝없는 수직 갱도를 내려가는 긴장감 넘치는 턴제 생존 게임.

## 2. 타겟 오디언스
-   **주 타겟**: 퍼즐 전략 장르를 즐기는 모바일 게이머 (예: *Hoplite*, *Downwell*).
-   **보조 타겟**: 짧고 굵은 플레이 타임(3~5분)을 선호하는 로그라이크 팬.
-   **동기 부여**: 높은 난이도, 빠른 의사결정, 만족스러운 콤보 플레이.

## 3. 핵심 게임플레이 루프
1.  **하강 (Descend)**: 적의 무리나 압박해오는 천장(추가 예정)을 피해 8x10 그리드를 내려갑니다.
2.  **생존 (Survive)**: 전략적인 위치 선정을 통해 적을 막거나, 공격하거나, 콤보를 터뜨립니다.
3.  **파밍 (Loot)**: 상자를 열어 업그레이드(HP, 공격력, 스킬)를 획득합니다.
4.  **사망 및 반복 (Die & Repeat)**: 로그라이트 특성상 죽음은 빈번하지만, 메타 진행을 통해 보상을 얻습니다.

## 4. 기능 요구 사항

### 1단계: MVP (완료)
-   [x] **그리드 시스템**: 반응형 8x10 그리드.
-   [x] **턴 시스템**: 하이브리드 방식 (플레이어 이동 또는 2초 타이머).
-   [x] **기본 전투**: 공격, 반격, 안전한 처치(Safe Kill).
-   [x] **적 AI**: 수직 이동(중력), 충돌 및 대기 로직.
-   [x] **체인 콤보**: 연결된 적 동시 처치.
-   [x] **오브젝트**: 상자(Chest), 파괴 가능한 블록.

### 2단계: 알파 (완료)
-   [x] **게임 오버 루프**: 플레이어 사망 -> 결과 화면 -> 재시작.
-   [x] **점수 시스템**: 도달 깊이(스테이지), 처치 수, 최대 콤보 (StageProgress 기반).
-   [x] **레벨 진행**: 난이도 곡선 (스테이지 진행도에 따른 스폰율 증가).
-   [x] **아이템 시스템**: 상자에서 사용 가능한 아이템 드롭 (포션, 주문서).
-   [x] **인벤토리 및 효과**: 아이템 보관 및 지속성 버프 시스템.
-   [x] **종합 테스트**: 핵심 로직 단위 테스트 및 QA 계획 수립.
### 3단계: 베타 (진행 중)
- [ ] **UI 및 게임 흐름**:
  - **로비 화면(Lobby)**: 게임 타이틀, 시작하기 버튼, 설정 버튼.
  - **설정 메뉴(Settings)**: 오디오(BGM/SFX) 온/오프, 진동 설정.
  - **결과 화면(Result)**: 최종 점수, 스테이지 진행도, 획득 보상 요약.
- [ ] **신규 적**: 원거리(궁수), 고속(슬라임), 탱커(골렘).
- [ ] **스킬/업그레이드**: 액션 카드 또는 상황별 스킬 (예: 밀치기, 기절).
- [ ] **비주얼 폴리싱**: 이동, 공격, 사망, 체인 폭발 애니메이션 (고도화).
- [ ] **오디오**: 배경음악(BGM) 및 효과음(SFX) 리소스 적용.
 Maryland

## 5. 기술 스택
-   **엔진**: Flutter + Flame
-   **상태 관리**: Flame 컴포넌트 트리(Component Tree).
-   **데이터 저장**: `shared_preferences` (최고 점수), Hive/Isar (플레이 기록).

## 6. 성공 지표 (KPIs)
-   **플레이 타임**: 평균 5분 이상.
-   **리텐션 (잔존율)**: D1 > 35%.
-   **콤보 만족도**: 플레이어의 체인 메카닉 활용도 (분석 툴로 추적).

## 7. 로드맵 및 우선순위
| 우선순위 | 기능 | 설명 |
| :--- | :--- | :--- |
| **P0** | 신규 적 (궁수/골렘) | 전투의 다양성과 전략적 깊이 확보. |
| **P1** | 스킬 시스템 (카드) | 성장의 재미와 로그라이트 요소 강화. |
| **P2** | 비주얼/오디오 완성 | 제품의 시장성(Polishing) 확보. |

---

## 2단계: 알파 상세 설계 아카이브 (완료됨)
*(이전 설계 내역은 `docs/` 폴더의 개별 문서 참고)*
- **Game Over**: 사망 탐지 및 재시작 흐름 설계 완료.
- **Score**: StageProgress 기반 로그 스케일링 공식 적용 완료.
- **Spawn**: 동적 스폰 커브 및 틱 기반 스폰 연동 완료.
- **Item**: 아이템 분류, 드롭 테이블, 버프 관리자, 인벤토리 HUD 구현 완료.
- **Test**: 종합 테스트 계획 및 기초 단위 테스트 구현 완료.
